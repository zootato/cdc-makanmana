"use strict";(self.webpackChunkcdc_makanmana=self.webpackChunkcdc_makanmana||[]).push([[248],{248:(t,e,a)=>{a.d(e,{HalalService:()=>n});class n{static async initialize(){var t;if(this.initialized)return;let e=null;for(let n=1;n<=3;n++)try{console.log("Attempt ".concat(n,"/").concat(3,": Fetching halal establishments..."));const t=new AbortController,e=setTimeout(()=>t.abort(),1e4),a=await fetch("https://raw.githubusercontent.com/zootato/singapore-halal-establishments/main/halal_establishments.json",{signal:t.signal,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(clearTimeout(e),!a.ok)throw new Error("GitHub API returned ".concat(a.status,": ").concat(a.statusText));return this.halalEstablishments=await a.json(),this.initialized=!0,void console.log("\u2705 Successfully loaded ".concat(this.halalEstablishments.length," halal establishments from GitHub"))}catch(a){if(e=a instanceof Error?a:new Error(String(a)),console.warn("\u274c Attempt ".concat(n," failed:"),e.message),n<3){const t=1e3*Math.pow(2,n);console.log("\u23f3 Retrying in ".concat(t/1e3,"s...")),await new Promise(e=>setTimeout(e,t))}}console.error("\ud83d\udeab Failed to load halal establishments after ".concat(3," attempts:"),null===(t=e)||void 0===t?void 0:t.message),console.error("\ud83d\udd04 Halal filtering will be disabled for this session"),this.halalEstablishments=[],this.initialized=!0}static async isHalal(t){if(await this.initialize(),0===this.halalEstablishments.length)return console.log('\u26a0\ufe0f No halal data available - cannot verify "'.concat(t.name,'"')),{isHalal:!1,source:"HALAL_DATA_UNAVAILABLE"};const e=this.findBestNameMatch(t.name,t.postalCode);return e?{isHalal:!0,source:e.source,certNumber:e.establishment.number}:{isHalal:!1,source:"NOT_IN_OFFICIAL_RECORDS"}}static findBestNameMatch(t,e){const a=this.cleanName(t),n=this.halalEstablishments.find(t=>this.cleanName(t.name)===a);if(n)return n.postal===e?{establishment:n,source:"MUIS_VERIFIED_EXACT_POSTAL"}:{establishment:n,source:"MUIS_VERIFIED_EXACT_NAME"};const s=a.split(" ").filter(t=>t.length>2);let l=null;for(const i of this.halalEstablishments){const a=this.cleanName(i.name).split(" ").filter(t=>t.length>2),n=s.filter(t=>a.some(e=>e.includes(t)||t.includes(e)||this.isWordSimilar(t,e))),c=n.length/Math.max(s.length,a.length),o=i.postal===e,r=this.hasSpecificBusinessMatch(s,a,n);if(c>=.95&&n.length>=3&&r)console.log('\ud83d\udd4c POTENTIAL HALAL MATCH:\n          CDC: "'.concat(t,'" (postal: ').concat(e,')\n          MUIS: "').concat(i.name,'" (postal: ').concat(i.postal,")\n          Similarity: ").concat((100*c).toFixed(1),"%\n          Matching words: [").concat(n.join(", "),"]\n          Postal match: ").concat(o?"\u2705":"\u274c")),(!l||o&&!l.hasPostal||o===l.hasPostal&&c>l.similarity)&&(l={establishment:i,similarity:c,hasPostal:o});else if(c>=.8&&n.length>=2){const e=n.filter(t=>!["western","food","kitchen","restaurant","cafe","stall","house","corner","snack","delight","express","garden","center","place","shop","store","pte","ltd","private","limited","trading","enterprise","company"].includes(t.toLowerCase()));console.log('\u274c REJECTED MATCH: "'.concat(t,'" vs "').concat(i.name,'"\n          Reason: Similarity ').concat((100*c).toFixed(1),"% (need 95%+), ").concat(n.length," matches (need 3+), ").concat(e.length," specific matches (need 2+)\n          Matching words: [").concat(n.join(", "),"]\n          Specific matches: [").concat(e.join(", "),"]"))}}if(l){const e=l.hasPostal?{establishment:l.establishment,source:"MUIS_VERIFIED_SIMILAR_POSTAL"}:{establishment:l.establishment,source:"MUIS_VERIFIED_SIMILAR_NAME"};return console.log('\u2705 HALAL CONFIRMED: "'.concat(t,'" \u2192 "').concat(l.establishment.name,'" (Cert: ').concat(l.establishment.number,")")),e}return console.log('\u274c NOT HALAL: "'.concat(t,'" - no match found in MUIS database')),null}static hasSpecificBusinessMatch(t,e,a){const n=new Set(["western","food","kitchen","restaurant","cafe","stall","house","corner","snack","delight","express","garden","center","place","shop","store","pte","ltd","private","limited","trading","enterprise","company"]);return a.filter(t=>!n.has(t.toLowerCase())).length>=2}static isWordSimilar(t,e){const a={restaurant:["rest","resto"],kitchen:["kitchn","kitch"],food:["fd"],house:["hse"],corner:["cnr"],centre:["center","ctr"],international:["intl"],company:["co"],private:["pte","pvt"],limited:["ltd"]};for(const[i,c]of Object.entries(a))if(t===i&&c.includes(e)||e===i&&c.includes(t)||c.includes(t)&&c.includes(e))return!0;const n=t.length>e.length?t:e,s=t.length>e.length?e:t;if(0===n.length)return!1;const l=this.levenshteinDistance(n,s);return(n.length-l)/n.length>=.8}static levenshteinDistance(t,e){const a=Array(e.length+1).fill(null).map(()=>Array(t.length+1).fill(null));for(let n=0;n<=t.length;n++)a[0][n]=n;for(let n=0;n<=e.length;n++)a[n][0]=n;for(let n=1;n<=e.length;n++)for(let s=1;s<=t.length;s++){const l=t[s-1]===e[n-1]?0:1;a[n][s]=Math.min(a[n][s-1]+1,a[n-1][s]+1,a[n-1][s-1]+l)}return a[e.length][t.length]}static cleanName(t){return t.toLowerCase().replace(/\b(pte|ltd|private|limited|sdn|bhd)\b/g,"").replace(/\b(stall|#|unit|\d+[a-z]?)\s*\d+/g,"").replace(/[^\w\s]/g," ").replace(/\s+/g," ").trim()}}n.halalEstablishments=[],n.initialized=!1}}]);
//# sourceMappingURL=248.e8b43f54.chunk.js.map