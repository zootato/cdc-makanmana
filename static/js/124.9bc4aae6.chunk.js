"use strict";(self.webpackChunkcdc_makanmana=self.webpackChunkcdc_makanmana||[]).push([[124],{124:(a,e,t)=>{t.d(e,{DataEnhancementService:()=>c});var s=t(555);class n{static async getPhoneNumber(a,e){if(!this.GOOGLE_MAPS_API_KEY)return console.warn("Google Maps API key not configured"),null;try{const s="".concat(a," ").concat(e," Singapore"),n=await fetch("".concat(this.PLACES_API_URL,"/textsearch/json?query=").concat(encodeURIComponent(s),"&key=").concat(this.GOOGLE_MAPS_API_KEY));if(!n.ok)return null;const o=await n.json();if(o.results&&o.results.length>0){var t;const a=o.results[0].place_id,e=await fetch("".concat(this.PLACES_API_URL,"/details/json?place_id=").concat(a,"&fields=formatted_phone_number&key=").concat(this.GOOGLE_MAPS_API_KEY));if(!e.ok)return null;return(null===(t=(await e.json()).result)||void 0===t?void 0:t.formatted_phone_number)||null}return null}catch(s){return console.error("Google Maps API error:",s),null}}}n.GOOGLE_MAPS_API_KEY={NODE_ENV:"production",PUBLIC_URL:"/cdc-makanmana",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_GOOGLE_MAPS_API_KEY,n.PLACES_API_URL="https://maps.googleapis.com/maps/api/place";class o{static async getBusinessInfo(a,e){try{const t=await fetch("".concat(this.SEARCH_URL,"?searchVal=").concat(encodeURIComponent(a+" "+e),"&returnGeom=Y&getAddrDetails=Y"));if(!t.ok)return null;const s=await t.json();if(s.found>0&&s.results.length>0){const t=s.results[0],n={name:t.SEARCHVAL||a,address:t.ADDRESS||e,postal:t.POSTAL||"",phone:t.PHONE||void 0,category:t.CATEGORY||void 0};return n.operating_hours=this.estimateHoursFromCategory(t.CATEGORY||a),n}return null}catch(t){return console.error("OneMap API error:",t),null}}static estimateHoursFromCategory(a){const e=a.toLowerCase();return e.includes("restaurant")||e.includes("food")||e.includes("dining")?{monday:"11:00-22:00",tuesday:"11:00-22:00",wednesday:"11:00-22:00",thursday:"11:00-22:00",friday:"11:00-23:00",saturday:"11:00-23:00",sunday:"11:00-22:00"}:e.includes("coffee")||e.includes("cafe")||e.includes("breakfast")?{monday:"07:00-15:00",tuesday:"07:00-15:00",wednesday:"07:00-15:00",thursday:"07:00-15:00",friday:"07:00-15:00",saturday:"07:00-15:00",sunday:"08:00-14:00"}:e.includes("supermarket")||e.includes("grocery")||e.includes("mart")?{monday:"08:00-22:00",tuesday:"08:00-22:00",wednesday:"08:00-22:00",thursday:"08:00-22:00",friday:"08:00-22:00",saturday:"08:00-22:00",sunday:"08:00-21:00"}:e.includes("massage")||e.includes("spa")||e.includes("wellness")?{monday:"10:00-22:00",tuesday:"10:00-22:00",wednesday:"10:00-22:00",thursday:"10:00-22:00",friday:"10:00-22:00",saturday:"10:00-22:00",sunday:"10:00-20:00"}:{monday:"09:00-18:00",tuesday:"09:00-18:00",wednesday:"09:00-18:00",thursday:"09:00-18:00",friday:"09:00-18:00",saturday:"09:00-17:00",sunday:"Closed"}}}o.BASE_URL="https://developers.onemap.sg/privateapi/popapi/getAllPOIs",o.SEARCH_URL="https://developers.onemap.sg/commonapi/search";class r{static async isHalalCertified(a,e){try{const s="".concat(a,"_").concat(e).toLowerCase();var t;if(this.halalCache.has(s)&&this.isCacheValid())return(null===(t=this.halalCache.get(s))||void 0===t?void 0:t.isHalal)||!1;const n=await this.checkMUISAPI(a);if(null!==n)return this.halalCache.set(s,{isHalal:n.isHalal,details:n.details}),this.lastCacheUpdate=new Date,console.log("\u2705 MUIS API verified: ".concat(a," - ").concat(n.isHalal?"HALAL":"NOT CERTIFIED")),n.isHalal;console.warn("\u26a0\ufe0f MUIS API failed for ".concat(a,", using keyword detection"));const o=await this.checkHalalByKeywords(a,e);return this.halalCache.set(s,{isHalal:o,details:null}),this.lastCacheUpdate=new Date,o}catch(s){return console.error("MUIS Halal check error:",s),this.checkHalalByKeywords(a,e)}}static async checkMUISAPI(a){try{const e="undefined"!==typeof window?this.MUIS_PROXY_URL:this.MUIS_API_URL,t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({text:a.trim()})});if(!t.ok)return 400===t.status?(console.warn("\ud83d\udd12 MUIS API requires CSRF token (".concat(t.status,") for: ").concat(a)),console.info("\ud83d\udca1 Consider setting up a proxy server for full MUIS integration")):console.warn("MUIS API returned ".concat(t.status," for: ").concat(a)),null;const s=await t.json();let n=[];if(s.results&&Array.isArray(s.results)?(n=s.results,console.log("\ud83d\udce1 Proxy server response: ".concat(s.totalRecords," total records"))):s.data&&Array.isArray(s.data)&&(n=s.data),0===n.length)return{isHalal:!1,details:null};const o=a.toLowerCase(),r=n.find(a=>{const e=a.name.toLowerCase();if(e.includes(o)||o.includes(e))return!0;const t=o.replace(/\b(pte|ltd|singapore|s\)|restaurant|cafe|food|stall|@|#\d+|\(.*?\))\b/g,"").trim(),s=e.replace(/\b(pte|ltd|singapore|s\)|restaurant|cafe|food|stall|@|#\d+|\(.*?\))\b/g,"").trim();if(t.length>=3&&s.length>=3){if(s.includes(t)||t.includes(s))return!0;const a=t.split(" ").filter(a=>a.length>=3),e=s.split(" ").filter(a=>a.length>=3),n=a.filter(a=>e.some(e=>e.includes(a)||a.includes(e)));if(n.length>=2||a.length<=2&&n.length>=1)return!0}return!1});return r?(console.log("\ud83d\udd4c MUIS VERIFIED: ".concat(a,' matches "').concat(r.name,'" (Cert: ').concat(r.number,")")),{isHalal:!0,details:{matchedEstablishment:r,totalFound:n.length,searchResults:n}}):(console.log("\u26a0\ufe0f MUIS: Found ".concat(n.length,' results for "').concat(a,'" but no close matches')),{isHalal:!1,details:{searchResults:n,totalFound:n.length}})}catch(e){return e instanceof TypeError&&e.message.includes("Failed to fetch")?(console.warn("\ud83d\udeab MUIS API CORS blocked for: ".concat(a,". This is expected when running from browser.")),console.info("\ud83d\udca1 MUIS API integration works best from server-side or with proxy setup")):console.error("Error calling MUIS API:",e),null}}static async getHalalCertificationStatus(a,e){try{if("undefined"!==typeof window&&!this.ENABLE_BROWSER_API_CALLS){const t=await this.checkHalalByKeywords(a,e);return{isHalal:t,source:t?"KEYWORD_DETECTED":"NOT_DETECTED"}}const t=this.cleanMerchantNameForSearch(a);console.log('\ud83d\udd0d Checking MUIS API for CDC merchant: "'.concat(a,'" (cleaned: "').concat(t,'")'));const s=await this.checkMUISAPI(t);if(null!==s){const e=s.isHalal?"MUIS_VERIFIED":"MUIS_NOT_FOUND";return console.log('\ud83d\udd4c MUIS Result for "'.concat(a,'": ').concat(s.isHalal?"HALAL CERTIFIED":"NOT CERTIFIED"," (").concat(e,")")),{isHalal:s.isHalal,source:e}}console.info("\ud83d\udd0d MUIS API unavailable, using enhanced keyword detection for: ".concat(a));const n=await this.checkHalalByKeywords(a,e);return{isHalal:n,source:n?"KEYWORD_DETECTED":"NOT_DETECTED"}}catch(t){console.error("Error getting halal certification status:",t);const s=await this.checkHalalByKeywords(a,e);return{isHalal:s,source:s?"KEYWORD_DETECTED":"NOT_DETECTED"}}}static cleanMerchantNameForSearch(a){return a.replace(/\b(pte ltd|pte|ltd|singapore|s'pore|sgp)\b/gi,"").replace(/#\d+[-\w]*|\(.*?\)|@.*$/gi,"").trim().split(" ").slice(0,4).join(" ").trim()}static async checkHalalByKeywords(a,e){const t="".concat(a," ").concat(e).toLowerCase();return!["pork","bacon","ham","char siew","siu mai","wine","beer","alcohol","bar","pub"].some(a=>t.includes(a))&&["halal","muslim","islamic","bismillah","assalam","salam","turkish","arab","arabian","middle east","lebanese","moroccan","pakistani","afghan","persian","kurdish","warung","nasi padang","makan","warong","mamak","rendang","satay","gado gado","nasi lemak","laksa","biryani","tandoor","mutton","kebab","korma","al-","ibn","abu","fatimah","aisha","khadijah","rahman","rahim","allah","mosque","masjid"].some(a=>t.includes(a))}static async getHalalCertificationDetails(a){try{return console.log("Getting MUIS certification for: ".concat(a)),null}catch(e){return console.error("MUIS certification details error:",e),null}}static isCacheValid(){return!!this.lastCacheUpdate&&Date.now()-this.lastCacheUpdate.getTime()<this.CACHE_DURATION}static clearCache(){this.halalCache.clear(),this.lastCacheUpdate=null}}r.MUIS_API_URL="https://halal.muis.gov.sg/api/halal/establishments",r.halalCache=new Map,r.lastCacheUpdate=null,r.CACHE_DURATION=864e5,r.ENABLE_BROWSER_API_CALLS=!0,r.MUIS_PROXY_URL="http://localhost:3001/api/muis-halal";class c{static async enhanceMerchantWithExternalData(a){const e=(0,s.A)({},a);try{let s=null;try{s=await n.getPhoneNumber(a.name,a.address),s&&(console.log("\u2705 Google Maps phone found for ".concat(a.name)),e.phone=s)}catch(t){console.warn("Google Maps API failed for ".concat(a.name,":"),t)}if(!s){const t=await o.getBusinessInfo(a.name,a.address);t&&(e.phone||(e.phone=t.phone),e.businessCategory=t.category)}const c=await r.getHalalCertificationStatus(a.name,a.address);e.isHalal=c.isHalal,e.halalSource=c.source}catch(t){console.error("Error enhancing merchant data:",t)}return e}}}}]);
//# sourceMappingURL=124.9bc4aae6.chunk.js.map